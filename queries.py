queries = ['''select * from tb_mun m where exists(select 1 from tb_domicilio d inner join tb_familia f on f.id_familia = d.id_familia where f.cd_ibge = m.cd_ibge and d.cod_agua_canalizada_fam=1)''', '''select * from tb_mun m where exists(select 1 from tb_domicilio d inner join tb_familia f on f.id_familia = d.id_familia where f.cd_ibge = m.cd_ibge and d.cod_agua_canalizada_fam=2)''', '''SELECT sum(media_renda_bruta_nordeste) as media_renda_bruta_nordeste, sum(media_renda_bruta_outros) as media_renda_bruta_outros FROM ( SELECT trunc(avg(val_renda_bruta_12_meses_memb), 2) as media_renda_bruta_nordeste, 0 as media_renda_bruta_outros FROM tb_trab t INNER JOIN tb_familia f ON f.id_familia = t.id_familia INNER JOIN tb_mun m ON m.cd_ibge = f.cd_ibge WHERE m.regiao = '2 - Nordeste' UNION ALL SELECT 0 as media_renda_bruta_nordeste, trunc(avg(val_renda_bruta_12_meses_memb), 2) as media_renda_bruta_outros FROM tb_trab t INNER JOIN tb_familia f ON f.id_familia = t.id_familia INNER JOIN tb_mun m ON m.cd_ibge = f.cd_ibge WHERE m.regiao != '2 - Nordeste') AS total;''', '''SELECT tb_mun.regiao AS "Região", ROUND(AVG(tb_familia.qtde_pessoas)) AS "Média de Pessoas" FROM tb_domicilio INNER JOIN tb_familia ON tb_domicilio.id_familia = tb_familia.id_familia INNER JOIN tb_mun ON tb_familia.cd_ibge = tb_mun.cd_ibge WHERE tb_domicilio.cod_destino_lixo_domic_fam = 1 GROUP BY tb_mun.regiao;''','''SELECT COUNT(DISTINCT(tb_pessoa.id_pessoa)) AS "Quantidade de Pessoas" FROM tb_pessoa INNER JOIN tb_trab ON tb_pessoa.id_pessoa = tb_trab.id_pessoa INNER JOIN tb_domicilio ON tb_pessoa.id_familia = tb_domicilio.id_familia WHERE tb_pessoa.cod_raca_cor_pessoa = 2 AND tb_domicilio.cod_especie_domic_fam = 1 AND tb_domicilio.cod_local_domic_fam = 1 AND tb_trab.val_remuner_emprego_memb > 3000''','''SELECT tb_mun.regiao AS "Região", MAX(tb_familia.qtde_pessoas) AS "Quantidade de Pessoas" FROM tb_domicilio INNER JOIN tb_familia ON tb_domicilio.id_familia = tb_familia.id_familia INNER JOIN tb_mun ON tb_familia.cd_ibge = tb_mun.cd_ibge WHERE tb_domicilio.qtd_comodos_domic_fam = 1 GROUP BY tb_mun.regiao''','''SELECT tb_mun.nome_municipio, COUNT(tb_familia.id_familia) AS "Quantidade de Famílias" FROM tb_domicilio INNER JOIN tb_familia ON tb_domicilio.id_familia = tb_familia.id_familia INNER JOIN tb_mun ON tb_familia.cd_ibge = tb_mun.cd_ibge WHERE tb_domicilio.cod_agua_canalizada_fam = 1 AND tb_domicilio.cod_abaste_agua_domic_fam = 1 AND tb_mun.uf = 'BA' GROUP BY tb_mun.nome_municipio ORDER BY tb_mun.nome_municipio LIMIT 15 OFFSET 0''','''SELECT tb_mun.nome_municipio, COUNT(tb_familia.id_familia) AS "Quantidade de Famílias" FROM tb_domicilio INNER JOIN tb_familia ON tb_domicilio.id_familia = tb_familia.id_familia INNER JOIN tb_mun ON tb_familia.cd_ibge = tb_mun.cd_ibge WHERE tb_domicilio.cod_material_domic_fam = 5 AND tb_domicilio.cod_abaste_agua_domic_fam = 1 AND tb_mun.regiao = '2 - Nordeste' GROUP BY tb_mun.nome_municipio ORDER BY COUNT(tb_familia.id_familia) DESC LIMIT 20 OFFSET 0''','''SELECT subquery.proporcao_nascente_outros, subquery.proporcao_nascente_total, subquery.tipo_abastecimento_predominante FROM (SELECT ROUND(total_nascente / (total_rede + total_cisterna + total_outros), 2) AS proporcao_nascente_outros, ROUND(total_nascente / (total_rede + total_cisterna + total_outros + total_nascente), 2) AS proporcao_nascente_total, CASE WHEN total_nascente_u >= total_rede_u AND total_nascente_u >= total_cisterna_u AND total_nascente_u >= total_outros_u THEN 'Nascente' WHEN total_rede_u >= total_cisterna_u AND total_rede_u >= total_outros_u THEN 'Rede' WHEN total_cisterna_u >= total_outros_u THEN 'Cisterna' ELSE 'Outros' END AS tipo_abastecimento_predominante FROM (SELECT (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 2 AND tb_domicilio.cod_local_domic_fam = 1) AS total_nascente, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 1 AND tb_domicilio.cod_local_domic_fam = 1) AS total_rede, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 3 AND tb_domicilio.cod_local_domic_fam = 1) AS total_cisterna, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 4 AND tb_domicilio.cod_local_domic_fam = 1) AS total_outros, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 2 AND tb_domicilio.cod_local_domic_fam = 1) AS total_nascente_u, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 1 AND tb_domicilio.cod_local_domic_fam = 1) AS total_rede_u, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 3 AND tb_domicilio.cod_local_domic_fam = 1) AS total_cisterna_u, (SELECT COUNT(*) * 1.0 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia INNER JOIN tb_domicilio ON tb_domicilio.id_familia = tb_familia.id_familia WHERE tb_domicilio.cod_abaste_agua_domic_fam = 4 AND tb_domicilio.cod_local_domic_fam = 1) AS total_outros_u) AS subquery) AS subquery;''','''SELECT tb_familia.id_familia, ROUND((COUNT(CASE WHEN idade > 65 THEN 1 ELSE NULL END) * 1.0 / COUNT(*) * 1.0), 3) AS proporcao_acima_de_65 FROM tb_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_pessoa.id_familia GROUP BY tb_familia.id_familia HAVING COUNT(*) > 4;''','''SELECT p.id_pessoa AS pessoa, f.id_familia AS familia, (pessoas_1 + pessoas_2 + pessoas_3 + pessoas_4 + pessoas_5 + pessoas_6) AS tb_total FROM (SELECT f.id_familia,SUM(CASE WHEN e.cod_curso_frequentou_pessoa_memb = 1 THEN 1 ELSE 0 END) AS pessoas_1, SUM(CASE WHEN e.cod_curso_frequentou_pessoa_memb = 2 THEN 1 ELSE 0 END) AS pessoas_2, SUM(CASE WHEN e.cod_curso_frequentou_pessoa_memb = 3 THEN 1 ELSE 0 END) AS pessoas_3, SUM(CASE WHEN e.cod_curso_frequentou_pessoa_memb = 4 THEN 1 ELSE 0 END) AS pessoas_4, SUM(CASE WHEN e.cod_curso_frequentou_pessoa_memb = 5 THEN 1 ELSE 0 END) AS pessoas_5, SUM(CASE WHEN e.cod_curso_frequentou_pessoa_memb = 6 THEN 1 ELSE 0 END) AS pessoas_6 FROM tb_pessoa p INNER JOIN tb_esc e ON e.id_familia = p.id_familia INNER JOIN tb_familia f ON f.id_familia = p.id_familia INNER JOIN tb_mun m ON m.cd_ibge = f.cd_ibge WHERE p.idade > 18 AND f.qtde_pessoas > 4 AND m.uf = 'BA' GROUP BY f.id_familia) AS subquery JOIN tb_pessoa p ON p.id_familia = subquery.id_familia JOIN tb_familia f ON f.id_familia = subquery.id_familia;''', '''SELECT tb_mun.uf AS estado, tb_pessoa.id_pessoa AS numero_pessoa, tb_familia.vlr_renda_media_fam AS renda_familia FROM tb_pessoa INNER JOIN tb_trab ON tb_trab.id_pessoa = tb_pessoa.id_pessoa INNER JOIN tb_familia ON tb_familia.id_familia = tb_trab.id_familia INNER JOIN tb_mun ON tb_mun.cd_ibge = tb_familia.cd_ibge WHERE tb_trab.val_renda_aposent_memb < (SELECT AVG(tb_trab.val_renda_aposent_memb) FROM tb_trab) AND tb_mun.regiao = '3 - Sudeste' GROUP BY tb_mun.uf, tb_pessoa.id_pessoa, tb_familia.vlr_renda_media_fam ORDER BY tb_mun.uf, tb_familia.vlr_renda_media_fam DESC;''','''SELECT tb_mun.uf AS estado, tb_mun.nome_municipio AS municipio, COUNT(*) AS quantidade_criancas_adolescentes, subquery.media_renda_pensao_alimenticia FROM tb_familia JOIN tb_pessoa ON tb_familia.id_familia = tb_pessoa.id_familia JOIN tb_trab ON tb_familia.id_familia = tb_trab.id_familia JOIN tb_mun ON tb_familia.cd_ibge = tb_mun.cd_ibge LEFT JOIN (SELECT f2.cd_ibge, AVG(t2.val_renda_pensao_alimen_memb) AS media_renda_pensao_alimenticia FROM tb_familia f2 JOIN tb_trab t2 ON f2.id_familia = t2.id_familia WHERE t2.val_renda_pensao_alimen_memb > 0 GROUP BY f2.cd_ibge) AS subquery ON tb_mun.cd_ibge = subquery.cd_ibge WHERE tb_pessoa.idade < 18 AND tb_trab.val_renda_pensao_alimen_memb > 0 GROUP BY tb_mun.uf, tb_mun.nome_municipio, subquery.media_renda_pensao_alimenticia;''', '''SELECT fa.vlr_renda_media_fam as renda_media_familia, tb.val_remuner_emprego_memb as salario,a.idade,a.escolaridade FROM (SELECT p.id_familia, p.id_pessoa,p.idade, CASE WHEN e.ind_frequenta_escola_memb = 1 THEN 'Sim. rede pública' WHEN e.ind_frequenta_escola_memb = 2 THEN 'Sim. rede particular' WHEN e.ind_frequenta_escola_memb = 3 THEN 'Não. já frequentou' ELSE 'Nunca frequentou' END as escolaridade FROM tb_esc e INNER JOIN tb_pessoa p ON p.id_pessoa = e.id_pessoa WHERE p.idade > 25 AND e.ind_frequenta_escola_memb IN (1, 2, 4)) AS a INNER JOIN tb_trab tb ON a.id_familia = tb.id_familia INNER JOIN tb_familia fa ON fa.id_familia = a.id_familia ORDER BY fa.vlr_renda_media_fam DESC;''','''SELECT a.vlr_renda_media_fam as renda_media_familia,a.regiao, CASE tb.cod_principal_trab_memb WHEN 1 THEN 'Trabalhador por conta própria (bico, autônomo)' WHEN 2 THEN 'Trabalhador temporário em área rural' WHEN 3 THEN 'Empregado sem carteira de trabalho assinada' WHEN 4 THEN 'Empregado com carteira de trabalho assinada' WHEN 5 THEN 'Trabalhador doméstico sem carteira de trabalho assinada' WHEN 6 THEN 'Trabalhador doméstico com carteira de trabalho assinada' WHEN 7 THEN 'Trabalhador não-remunerado' WHEN 8 THEN 'Militar ou servidor público' WHEN 9 THEN 'Empregador' WHEN 10 THEN 'Estagiário' WHEN 11 THEN 'Aprendiz' ELSE 'Campo é nulo' END as tipo_emprego FROM (SELECT fa.id_familia,fa.vlr_renda_media_fam,mn.regiao FROM tb_mun mn INNER JOIN tb_familia fa ON mn.cd_ibge = fa.cd_ibge WHERE mn.regiao IN ('1 - Norte', '2 - Nordeste')) AS a INNER JOIN tb_trab tb ON tb.id_familia = a.id_familia WHERE tb.cod_principal_trab_memb IS NOT NULL;''','''SELECT AVG(to_number(tb.vlr_renda_media_fam, '999999999')) as media_renda, mn.nome_municipio as municipio FROM (SELECT pe.id_familia, pe.id_pessoa, es.IND_FREQUENTA_ESCOLA_MEMB FROM tb_pessoa pe INNER JOIN tb_esc es ON pe.id_pessoa = es.id_pessoa WHERE pe.cod_sexo_pessoa = 2 AND es.IND_FREQUENTA_ESCOLA_MEMB IN (1, 2, 4)) AS a INNER JOIN tb_familia tb ON tb.id_familia = a.id_familia INNER JOIN tb_mun mn ON mn.cd_ibge = tb.cd_ibge GROUP BY mn.nome_municipio;''']

indexes = ['''CREATE INDEX idx_familia ON tb_familia (id_familia); CREATE INDEX iddx_familia on tb_trab (id_familia);''','''CREATE INDEX indice_familia ON tb_familia (id_familia); CREATE INDEX indice_ibge ON tb_familia (cd_ibge); CREATE INDEX indicee_familia ON tb_domicilio (id_familia); CREATE INDEX indiceee_familia ON tb_pessoa (id_familia); CREATE INDEX indice_pessoa ON tb_pessoa (id_pessoa); CREATE INDEX indicee_ibge ON tb_mun (cd_ibge);''', '''CREATE INDEX indice_cod_abaste_agua_domic_fam ON tb_domicilio (cod_abaste_agua_domic_fam); CREATE INDEX indice_uf ON tb_mun (uf); CREATE INDEX indice_cod_curso_frequentou_pessoa_memb ON tb_esc (cod_curso_frequentou_pessoa_memb); CREATE INDEX indicexc_id_familia ON tb_esc (id_familia);''']
           
drop_indexes = ['''DROP INDEX idx_familia; DROP INDEX iddx_familia;''', '''DROP INDEX indice_familia; DROP INDEX indice_ibge; DROP INDEX indicee_familia; DROP INDEX indiceee_familia; DROP INDEX indice_pessoa; DROP INDEX indicee_ibge;''', '''DROP INDEX indice_cod_abaste_agua_domic_fam; DROP INDEX indice_uf; DROP INDEX indice_cod_curso_frequentou_pessoa_memb; DROP INDEX indicexc_id_familia''']



